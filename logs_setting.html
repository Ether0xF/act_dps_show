<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="./common.js?v=5"></script>
	<!-- <script src="./config/ccino/vue.min.js"></script> -->
	<script src="https://cdn.bootcss.com/vue/2.6.10/vue.min.js"></script>
    <title>Ccino dps setting</title>
    <style>
        .item .label{
            display:inline-block;
            width:100px;
            text-align: right;
        }
        .item .value{
            display:inline-block;
        }
        table td,table th{
            text-align: center;
        }
        table *{
            padding:3px;
        }
        table{
            margin:15px 0;
            border-collapse: collapse;
        }
        table tr{
            border-top:1px solid #ddd;
        }
        table tr:first-child,table tr:nth-child(2){
            border-top:2px solid #ccc;
        }
        table tr td,table tr th{
            border-right:1px solid #ddd;
        }
        [v-cloak]{
            display: none;
        }
        table input{
            width:50px;
        }
        .option-pad{
            position:fixed;
            background-color:white; 
            width:80%;
            height:50%;
            left:10%;
            top:10%;
            border-radius:10px;
            box-shadow: 0px 0px 10px black;
            padding:30px 20px;
            z-index:10;
        }
        .option-pad-mask{
            z-index:9;
            background-color:rgba(0,0,0,0.3);
            position:fixed;
            width:100%;
            height:100%;
            top:0;
            left:0;
        }
        .option-pad-close{
            display:inline-block;
            width:10px;height:10px;
            box-shadow: 0px 0px 5px red;
            border-radius: 5px;
            position:absolute;
            top:10px;
            right:10px;
            cursor: pointer;
        }
        .option-pad-close:hover{
            transform: scale(1.2);
        }

    </style>
</head>
<body>
	<div id="container" v-cloak>
        <div class="item">
            <div class="label">
                apiKey
            </div>
            <div class="value">
                <input type="text" v-model="option.apiKey"/>
            </div>
        </div>
        <hr>
        <div class="item">
            <div class="label">
                字体大小
            </div>
            <div class="value">
                <input type="number"  max="100" min="9" v-model="option.fontSize"/>
                px
            </div>
            <div class="label" style="width:150px;margin-left:50px;">
                背景透明度
            </div>
            <div class="value">
                <input type="range" max="100" min="0" v-model="backgroundAlpha"/>{{backgroundAlpha}}
            </div>
        </div>
        <hr>
        <div class="item">
            <div class="label" style="width:100px;">
                显示时间
            </div>
            <div class="value">
                <input type="number"  min="1" v-model="option.logsInfoShownDuration" style="width:60px"/>
                秒
            </div>
            <div class="label" style="margin-left:50px;">
                副本名宽度
            </div>
            <div class="value">
                <input type="range" max="70" min="0" v-model="option.logsInfoEncounterNameWidth"/>{{option.logsInfoEncounterNameWidth}}
            </div>
        </div>
        <hr>
        <div class="item">
            <div class="label">
                服务器
            </div>
            <div class="value">
                <select v-model="option.selectedServer">
                    <option v-for="server in serverList" :value="server">{{server}}</option>
                </select>
            </div>

            <div class="label">
                区域副本
            </div>
            <div class="value">
                <select v-model="option.selectedZone">
                    <option v-for="zone in zoneList" :value="zone">{{zone.name}}</option>
                </select>
            </div>
            <div class="value">
                <select v-model="option.selectedEncounter">
                    <option v-for="encounter in option.selectedZone.encounters" :value="encounter">{{encounter.name}}</option>
                </select>
            </div>
        </div>
        <hr>
        <div class="item">
            <div class="label">
                前端显示配置
            </div>
            <div class="value">
                <label>
                    <input type="checkbox" v-model="option.settingOnFrontpage.server" /> 服务器
                </label>
            </div>
            <div class="value">
                <label>
                    <input type="checkbox" v-model="option.settingOnFrontpage.zone" /> 副本区域
                </label>
            </div>
        </div>
        
        <div class="item">
                <hr>
            <div class="label">
            </div>
            <div class="value">
                <button @click="save">保存</button>
                <button @click="revert">重置</button>
                <span style="margin:20px;"></span>
                <button @click="showImportOption">配置信息</button>
                <button @click="revertDefault">重置默认</button>
                <a href="javascript:;">使用反馈: 5327373@qq.com</a>
            </div>
        </div>
        <div class="option-pad-mask" v-if="showOptionPad"></div>
        <div class="option-pad" v-if="showOptionPad" v-cloak>
            <span class="option-pad-close" @click="showOptionPad=false"></span>
            <textarea id="option_pad_textarea" v-model="optionStr" style="width:100%;height:calc(100% - 30px);resize:none"></textarea>
            
            <button @click="replaceOption" title="完全将配置替换为当前输入内容">覆盖配置</button>
            <button @click="importOption" title="将当前输入内容更新到当前配置中">导入配置</button>
            <span style="margin:20px;"></span>
            <button @click="selectAll">全选</button>
            <button @click="showOptionPad=false">关闭</button>
        </div>
	</div>

    <script>
        var option=JSON.parse(localStorage.getItem("CCINO_LOGS_OPTION"));
        function copy(o){
            return JSON.parse(JSON.stringify(o));
        }
        function save(){
            option._knownSetting=true;
            localStorage.setItem("CCINO_LOGS_OPTION",JSON.stringify(option))
        }
        var zoneList=[{"name":"<未选择>"},{"id":2,"name":"Dungeons (Endgame)","encounters":[{"id":4500,"name":"空中神域不获岛"},{"id":4501,"name":"博物战舰无限回廊"},{"id":4502,"name":"草木庭园圣茉夏娜植物园"},{"id":4503,"name":"地脉灵灯天狼星灯塔"},{"id":4504,"name":"星海空间颠倒塔"},{"id":4505,"name":"神圣遗迹无限城市街古迹"},{"id":4506,"name":"天龙宫殿忆罪宫"},{"id":4507,"name":"黑涡传说破舰岛"},{"id":4508,"name":"险峻峡谷塞尔法特尔溪谷"},{"id":4509,"name":"秘本宝库迦巴勒幻想图书馆"}],"brackets":{"min":3.0,"max":3.5,"bucket":0.1,"type":"版本"}},{"id":4,"name":"Trials (Extreme)","encounters":[{"id":1027,"name":"俾斯麦"},{"id":1028,"name":"罗波那"},{"id":1029,"name":"骑神托尔丹"},{"id":1031,"name":"萨菲洛特"},{"id":1033,"name":"尼德霍格"},{"id":1034,"name":"索菲娅"},{"id":1035,"name":"祖尔宛"}],"brackets":{"min":3.0,"max":3.5,"bucket":0.1,"type":"版本"}},{"id":5,"name":"Void Ark","encounters":[{"id":2000,"name":"刻托"},{"id":2001,"name":"天柱树"},{"id":2002,"name":"丘库雷因"},{"id":2003,"name":"艾奇德娜"}],"brackets":{"min":3.0,"max":3.5,"bucket":0.1,"type":"版本"}},{"id":6,"name":"Alexander: Gordias (Story)","encounters":[{"id":14,"name":"压迫者"},{"id":15,"name":"戈耳狄俄斯之袖"},{"id":16,"name":"有生命活水"},{"id":17,"name":"操纵者"},{"id":5000,"name":"浮士德"}],"brackets":{"min":3.0,"max":3.5,"bucket":0.1,"type":"版本"}},{"id":7,"name":"Alexander: Gordias (Savage)","encounters":[{"id":18,"name":"压迫者"},{"id":19,"name":"戈耳狄俄斯之袖"},{"id":20,"name":"有生命活水"},{"id":21,"name":"操纵者"},{"id":5001,"name":"浮士德"}],"brackets":{"min":3.0,"max":3.5,"bucket":0.1,"type":"版本"}},{"id":8,"name":"The Weeping City of Mhach","encounters":[{"id":2004,"name":"阿剌克涅"},{"id":2005,"name":"弗加尔"},{"id":2006,"name":"奥兹玛"},{"id":2007,"name":"卡洛菲斯提莉"}],"brackets":{"min":3.0,"max":3.5,"bucket":0.1,"type":"版本"}},{"id":9,"name":"Alexander: Midas (Story)","encounters":[{"id":22,"name":"奇才 拉特芬克斯"},{"id":23,"name":"环旋者"},{"id":24,"name":"万事通 奎克辛克斯"},{"id":25,"name":"残暴正义号"},{"id":5002,"name":"新型浮士德"},{"id":5003,"name":"爆破者"},{"id":5004,"name":"争斗者"},{"id":5005,"name":"欺诈者"}],"brackets":{"min":3.0,"max":3.5,"bucket":0.1,"type":"版本"}},{"id":10,"name":"Alexander: Midas (Savage)","encounters":[{"id":26,"name":"奇才 拉特芬克斯"},{"id":27,"name":"弥达斯之袖"},{"id":28,"name":"万事通 奎克辛克斯"},{"id":29,"name":"残暴正义号"},{"id":5006,"name":"新型浮士德"}],"brackets":{"min":3.0,"max":3.5,"bucket":0.1,"type":"版本"}},{"id":12,"name":"Alexander: The Creator (Story)","encounters":[{"id":30,"name":"废品翻新装置"},{"id":31,"name":"佣兵雷姆普里克斯"},{"id":32,"name":"巡航驱逐者"},{"id":33,"name":"至尊亚历山大"},{"id":5007,"name":"终极浮士德"}],"brackets":{"min":3.0,"max":3.5,"bucket":0.1,"type":"版本"}},{"id":13,"name":"Alexander: The Creator (Savage)","encounters":[{"id":34,"name":"废品翻新装置"},{"id":35,"name":"佣兵雷姆普里克斯"},{"id":36,"name":"巡航驱逐者"},{"id":37,"name":"至尊亚历山大"},{"id":5008,"name":"终极浮士德"}],"brackets":{"min":3.0,"max":3.5,"bucket":0.1,"type":"版本"}},{"id":14,"name":"Dungeons (Endgame)","encounters":[{"id":4510,"name":"鏖战红莲阿拉米格"},{"id":4511,"name":"恶党孤城黄金阁"},{"id":4512,"name":"修行古刹星导寺"},{"id":4513,"name":"沉没神殿斯卡拉遗迹"},{"id":4514,"name":"红玉火山狱之盖"},{"id":4515,"name":"疯狂战舰无限回廊"},{"id":4516,"name":"风水灵庙岩燕庙"},{"id":4517,"name":"死亡大地终末焦土"},{"id":4518,"name":"污染庭园圣茉夏娜植物园"},{"id":4519,"name":"国境战线基姆利特暗区"}],"brackets":{"min":4.0,"max":4.5,"bucket":0.1,"type":"版本"}},{"id":15,"name":"Trials (Extreme)","encounters":[{"id":1036,"name":"须佐之男"},{"id":1037,"name":"吉祥天女"},{"id":1038,"name":"神龙"},{"id":1040,"name":"白虎"},{"id":1041,"name":"月读"},{"id":1043,"name":"朱雀"},{"id":1044,"name":"青龙"}],"brackets":{"min":4.0,"max":4.5,"bucket":0.1,"type":"版本"}},{"id":16,"name":"Omega: Deltascape (Story)","encounters":[{"id":38,"name":"老者"},{"id":39,"name":"灾变者"},{"id":40,"name":"哈利卡纳苏斯"},{"id":41,"name":"艾克斯迪司"}],"brackets":{"min":4.0,"max":4.5,"bucket":0.1,"type":"版本"}},{"id":17,"name":"Omega: Deltascape (Savage)","encounters":[{"id":42,"name":"老者"},{"id":43,"name":"灾变者"},{"id":44,"name":"哈利卡纳苏斯"},{"id":45,"name":"艾克斯迪司"},{"id":46,"name":"新生艾克斯迪司"}],"brackets":{"min":4.0,"max":4.5,"bucket":0.1,"type":"版本"}},{"id":18,"name":"The Royal City of Rabanastre","encounters":[{"id":2008,"name":"背德皇帝马提乌斯"},{"id":2009,"name":"统治者哈修马利姆"},{"id":2010,"name":"人马王洛弗卡勒"},{"id":2011,"name":"冷血剑阿加斯"}],"brackets":{"min":4.0,"max":4.5,"bucket":0.1,"type":"版本"}},{"id":19,"name":"The Unending Coil of Bahamut","encounters":[{"id":1039,"name":"至尊巴哈姆特"}],"brackets":{"min":4.0,"max":4.5,"bucket":0.1,"type":"版本"}},{"id":20,"name":"Omega: Sigmascape (Story)","encounters":[{"id":47,"name":"魔列车"},{"id":48,"name":"恶魔查达奴克"},{"id":49,"name":"守护者"},{"id":50,"name":"凯夫卡"}],"brackets":{"min":4.0,"max":4.5,"bucket":0.1,"type":"版本"}},{"id":21,"name":"Omega: Sigmascape (Savage)","encounters":[{"id":51,"name":"魔列车"},{"id":52,"name":"恶魔查达奴克"},{"id":53,"name":"守护者"},{"id":54,"name":"凯夫卡"},{"id":55,"name":"神圣凯夫卡"}],"brackets":{"min":4.0,"max":4.5,"bucket":0.1,"type":"版本"}},{"id":22,"name":"The Ridorana Lighthouse","encounters":[{"id":2012,"name":"暗黑之云法姆弗里特"},{"id":2013,"name":"魔人贝利亚斯"},{"id":2014,"name":"劳动七号"},{"id":2015,"name":"鬼龙雅兹玛特"}],"brackets":{"min":4.0,"max":4.5,"bucket":0.1,"type":"版本"}},{"id":23,"name":"The Weapon's Refrain","encounters":[{"id":1042,"name":"究极神兵"}],"brackets":{"min":4.0,"max":4.5,"bucket":0.1,"type":"版本"}},{"id":24,"name":"Omega: Alphascape (Story)","encounters":[{"id":56,"name":"卡奥斯"},{"id":57,"name":"尘世幻龙"},{"id":58,"name":"欧米茄"},{"id":59,"name":"双生欧米茄"}],"brackets":{"min":4.0,"max":4.5,"bucket":0.1,"type":"版本"}},{"id":25,"name":"Omega: Alphascape (Savage)","encounters":[{"id":60,"name":"卡奥斯"},{"id":61,"name":"尘世幻龙"},{"id":62,"name":"欧米茄"},{"id":63,"name":"双生欧米茄"},{"id":64,"name":"至尊欧米茄"}],"brackets":{"min":4.0,"max":4.5,"bucket":0.1,"type":"版本"}},{"id":26,"name":"The Orbonne Monastery","encounters":[{"id":2016,"name":"机工士姆斯塔迪奥"},{"id":2017,"name":"圣骑士阿格莉亚丝"},{"id":2018,"name":"雷神西德"},{"id":2019,"name":"圣天使阿尔蒂玛"}],"brackets":{"min":4.0,"max":4.5,"bucket":0.1,"type":"版本"}},{"id":27,"name":"Dungeons (Endgame)","encounters":[{"id":4520,"name":"末日暗影亚马乌罗提"},{"id":4521,"name":"异界遗构希尔科斯孪晶塔"},{"id":4522,"name":"创造机构阿尼德罗学院"},{"id":4523,"name":"The Grand Cosmos"}],"brackets":{"min":5.0,"max":5.1,"bucket":0.1,"type":"版本"}},{"id":28,"name":"Trials (Extreme)","encounters":[{"id":1045,"name":"缇坦妮雅"},{"id":1046,"name":"无瑕灵君"},{"id":1049,"name":"哈迪斯"}],"brackets":{"min":5.0,"max":5.1,"bucket":0.1,"type":"版本"}},{"id":29,"name":"Eden's Gate","encounters":[{"id":65,"name":"Eden Prime"},{"id":66,"name":"虚空行者"},{"id":67,"name":"利维亚桑"},{"id":68,"name":"泰坦"}],"brackets":{"min":5.0,"max":5.1,"bucket":0.1,"type":"版本"}},{"id":30,"name":"Ultimates (Stormblood)","encounters":[{"id":1047,"name":"巴哈姆特绝境战"},{"id":1048,"name":"究极神兵绝境战"}],"brackets":{"min":5.0,"max":5.1,"bucket":0.1,"type":"版本"}},{"id":31,"name":"The Copied Factory","encounters":[{"id":2020,"name":"Serial-Jointed Command Model"},{"id":2021,"name":"Hobbes"},{"id":2022,"name":"Engels"},{"id":2023,"name":"9S-Operated Walking Fortress"}],"brackets":{"min":5.0,"max":5.1,"bucket":0.1,"type":"版本"}},{"id":32,"name":"Ultimates","encounters":[{"id":1050,"name":"The Epic of Alexander"}],"brackets":{"min":5.0,"max":5.1,"bucket":0.1,"type":"版本"}}];
        var serverList=["红玉海","神意之地","拉诺西亚","幻影群岛","萌芽池","宇宙和音","沃仙曦染","晨曦王座",
                        "白银乡","白金幻象","神拳痕","潮风亭","旅人栈桥","拂晓之间","龙巢神殿",
                        "紫水栈桥","延夏","静语庄园","摩杜纳","海猫茶屋","柔风海湾","琥珀原"];
        var vueapp=new Vue({
            el:"#container",
            data:{
                option:copy(option),
                colorOpacity:20,
                backgroundAlpha:30,
                deleteConfirm:true,
                showOptionPad:false,
                zoneList:zoneList,
                serverList:serverList,
                optionStr:"",
            },
            methods:{
                revertDefault:function(){
                    this.option={
                        fontSize: 13,
                        colors: {
                            background: "rgba(0,0,0,0.2)"
                        },
                        apiKey:"1dec8751508fa8e36cde7c53b550b69b",
                        supportLogsInfo:true,
                        logsInfoShownDuration:10,
                        logsInfoEncounterNameWidth:30,
                        logsInfoShowDetail:true,
                        selectedZone:zoneList[zoneList.length-4],
                        selectedEncounter:zoneList[zoneList.length-4].encounters[0],
                        selectedServer: serverList[0]
                    };
                },
                selectAll:function(){
                    var dom=document.getElementById("option_pad_textarea");
                    dom.focus();
                    dom.select();
                    dom.scrollTo(0,0);
                },
                showImportOption:function(){
                    this.optionStr=JSON.stringify(this.option,null,2);
                    this.showOptionPad=true;
                    this.$nextTick(function(){
                        vueapp.selectAll();
                    })
                },
                replaceOption:function(){
                    if(confirm("是否确认进行导入?\n导入后会完全替换为现有配置")){
                        try{
                            var newOption=JSON.parse(this.optionStr);
                            this.option=newOption;
                            alert("导入成功");
                        }catch(e){
                            console.error(e);
                            alert("该数据存在异常无法导入:\n"+((typeof e == "string")?e:""));
                        }
                    }
                },
                importOption:function(){
                    if(confirm("是否确认进行导入?\n会将内容属性更新到现有配置中")){
                        try{
                            var newOption=JSON.parse(this.optionStr);
                            this.option=mergeObj(this.option,newOption);
                            alert("导入成功");
                        }catch(e){
                            console.error(e);
                            alert("该数据存在异常无法导入:\n"+((typeof e == "string")?e:""));
                        }
                    }
                },
                save:function(){
                    option=copy(this.option);
                    if(!option.colors){
                        option.colors={};
                    }
                    option.colors.background="rgba(0,0,0,"+vueapp.backgroundAlpha/100+")"
                    save();
                    if(window.parent){
                        window.parent.close(window);
                    }
                },
                revert:function(){
                    this.option=copy(option);
                },
                revertModify:function(prop){
                    this.option[prop]=copy(option[prop]);
                },
                color2rgba:function(color){
                    var red,green,blue;
                    red=parseInt(color.substr(1,2),16);
                    green=parseInt(color.substr(3,2),16);
                    blue=parseInt(color.substr(5,2),16);
                    return "rgba("+red+","+green+","+blue+","+vueapp.colorOpacity/100+")";
                },
                rgba2color:function(rgba){
                    var reg=/\s*rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*((.|\d)+)\s*\)/.exec(rgba);
                    if(reg){
                        return {
                            color:"#"+padLeft((+reg[1]).toString(16),'0',2)
                                     +padLeft((+reg[2]).toString(16),'0',2)
                                     +padLeft((+reg[3]).toString(16),'0',2),
                            alpha:(+reg[4])*100
                        }
                    }
                },
            }
        });
        //vueapp.colorOpacity=vueapp.rgba2color(option.colors.tank).alpha;
        if(option.colors.background){
            var color=vueapp.rgba2color(option.colors.background);
            vueapp.backgroundAlpha=color.alpha;
        }else{
            vueapp.backgroundAlpha=30;
        }
        
    </script>
</body>
</html>